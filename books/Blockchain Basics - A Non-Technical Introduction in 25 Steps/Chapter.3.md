---

---

<!-- # 区块链如何工作 -->

---

# 8. 设计区块链

---

完全去中心化的点对点账本系统，它需要完成以下任务：

- 描述所有权
- 保护所有权
- 存储交易数据
- 准备在不可信环境中可分发的账本
- 构建一个分发账本机制
- 向所有账本添加并验证新的交易记录
- 确定描述真相的账本

---

# 9. 记录所有权

---

描述所有权转让的交易时，需要提供以下信息：

- 原所有权拥有者的账号标识符
- 交易目标的账号标识符
- 要交易的资产和数量
- 交易发生的时间
- 支付给系统的费用（手续费、维护费）
- 证明所有权拥有者同意该项交易

---

交易数据的完整历史记录是一个审计线索，是所有权相关的证据

不存在于记录中的交易视作没有发生

将交易数据添加到历史交易记录中，并对汇总交易数据造成影响

交易数据的历史记录有严格的时间顺序

---

满足如下条件的交易数据才可以被加入区块链数据结构中：

- 形式正确性
- 语义正确性
- 授权正确性

---

# 10. 哈希算法

---

哈希算法的输出具有空间局限性

不同哈希算法的空间输出不一定相同

加密哈希算法用来创建数字指纹工具

---

加密哈希算法的特征：

- 输入不检查类型
- 确定性
- 伪随机
- 单向函数
- 防碰撞

---

应用哈希算法的模式：

- 独立哈希
- 重复哈希
- 组合哈希
- 顺序哈希
- 分层哈希

---

# 11. 哈希在现实世界的应用

---

哈希引用的用途：

- 对比数据
- 检测数据是否发生改变
- 及时发现数据变化
- 存储大量数据
- 算力任务

---

# 12. 确认并保护用户账号的安全

---

加密用来保护数据安全，防止未经授权者获取数据

加密行为有：

- 加密——使用密钥将数据存储为加密文档
- 解密——使用密钥将密文还原成原数据

---

非对称加密中两个互补的密钥，一个用于加密，一个用于解密

现实中对可以共享的密钥称之为公钥，对其他人保密的密钥称之为私钥

私钥和公钥都能用于加密和解密，一个用于加密，另一个就用于解密

---

两种应用场景：

- 邮箱模式：使用公钥加密数据，仅个别人使用私钥可以读取数据
- 频道模式：仅个别人使用私钥发布加密数据，拥有公钥者可解密数据

---

加密技术的目标：

- 确认用户：用户的账户作为公钥
- 授权交易：账户拥有者使用私钥创建交易，其他人使用公钥确认交易者是私钥拥有者

---

# 13. 交易授权

---

签名表示签署者同意文档中的内容

手写签名的有效性是基于笔迹的唯一性

数字签名用于：

- 识别签署者
- 证明签署者同意文档内容，并授权执行

区块链中的数字签名可以追溯一个特定私钥授权的交易

---

# 14. 存储交易数据

---

区块链由区块构成，区块是一种有序单元

每个区块都有一个区块头和一个包含交易数据的默克尔树

所有的区块头组成的有序链和所有区块的默克尔树数据构成了区块链

每个区块头都有唯一的哈希引用，每个区块头引用其前一个区块头

交易数据是通过引用默克尔树根实现的

---

# 15. 区块链的数据存储

---

添加数据到区块链的步骤：

- 创建一个包含交易数据的默克尔树
- 创建包含上一个区块头哈希引用和新的交易数据的默克尔树根的区块头
- 创建新区块头的哈希引用

---

想改变一个区块的交易数据，就要从改动的地方向后依次修改每个区块的哈希引用，直到区块链最新的哈希引用为止

改动牵一发动全身，区块链对任何修改都非常敏感

任何对区块链数据的修改都会导致整个数据结构不一致，很容易检测到修改，这是哈希引用特性决定的

---

# 16. 保护数据的安全

---

确保交易历史不可变性来自于两点：

- 区块链数据结构对修改敏感，发生修改就要从修改点一直重写区块数据到整条链末端
- 哈希难题对每个区块头都是唯一的

每次写入区块或重写区块都要解决哈希难题，修改区块的成本变得极高，修改不如直接添加

---

区块头包含如下数据：

- 前一个区块头的哈希引用
- 交易数据的默克尔树根
- 哈希难题的难度等级
- 开始解决哈希难题的时间点
- 解决哈希难题的随机数

---

# 17. 点对点系统中数据的存储与分发

---

分布式点对点系统中的计算机通过互联网进行沟通

使用互联网构建的点对点系统有如下特点：

- 计算机通过互联网连接
- 每台计算机通过独特的地址辨识和通信
- 每台计算机都能在任意时间与系统断开或重连
- 每台计算机独立维护与其连接的一系列对等节点
- 节点之间通过消息通信

---

由于网络不一定完全可靠和存在恶意节点，节点间通信具有如下特点：

- 无法保证信息到达对端节点，可能会丢失
- 信息可能被重复传递
- 信息达到的顺序可能不正确

---

区块链节点通过如下方式在不可信网络中通信：

- 所有节点都会把自己收到的信息传给其对等节点
- 通过哈希值确定交易数据或区块是否有重复
- 根据交易数据和区块头中的时间戳来对信息进行排序

---

点对点系统节点通信的目的：

- 确保现有连接有效
- 建立新连接
- 分发收到的消息

---

转发所有权信息的情况：

- 持续模式：向所有连接的节点传递新的交易数据和区块信息
- 更新模式：向曾经断开现已重连的节点传递信息
- 加载模式：向新加入的节点传递全部区块链数据，确保其加入系统后成为成熟节点

---

# 18. 核实并添加交易数据

---

区块链算法就是一系列规则和指南，用于管理交易数据的处理和添加方式

区块链算法需要保证系统在开放的同时，添加的数据都是有效且经过授权的

区块链算法通过竞争和节点控制相结合的方式管理节点

节点控制的重点是允许系统中所有节点担任其对等节点的监督者

所有节点都应正确处理交易数据，并监督其他节点是否正确处理数据

---

区块链算法设计理念：

- 交易数据好区块头验证规则
- 奖励提交有效区块头的行为
- 惩罚破坏系统诚信的行为
- 节点基于速度和质量竞争原则争夺奖励
- 对等节点控制

---

竞争规则下系统节点的两种状态：

- 评估其他节点创建的区块
- 努力计算获得提交新区块的权力，并把新区块交给其他节点评估

一旦信息到达该节点，就开始评估

如果大多数节点都是诚信的且追求奖励的，就可以保证非诚信节点无法破坏整个系统的诚信

---

# 19. 选择交易数据的历史记录

---

网络消息发送出现延迟或并发，可能导致区块链出现树状链结构分支

选择哪个分支的记录是一个集体决策问题

分布式共识是集体决策问题达成的一种协议

---

区块链集体决策有如下特点：

- 所有节点都在维护区块链数据结构和控制节点的区块链算法
- 决策问题是在所有节点上选出相同历史交易记录
- 所有节点都努力向区块链中添加新区块以最大化自身奖励
- 节点一旦产生了新区块，就发送给其他节点，让它们检查这个区块并一起维护这个统一的账本
- 所有节点用相同的标准来选择历史交易记录

---

最长链标准是指节点选择包含最多区块的分支为权威链

最重链标准是指节点选择累积难度最高的分支为权威链

---

选择分支链会导致如下结果：

- 其他分支成为孤儿链（孤儿块）
- 其他分支情况提交时的奖励被回收
- 所有权根据选择的链得以明确
- 交易根据选择的链进行计算
- 主干会继续增长
- 最终一致性
- 健壮的抗操作性

---

随着时间推移，权威链的区块确定性会不断增加，最终会添加更多的区块，称为最终一致性

---

权威链中，一个区块位置越深：

- 它被添加的时间越久
- 它被加入权威链的时间越久
- 在它后面添加区块计算量越多
- 它所在权威链被更改可能性越小
- 它被抛弃可能性越小
- 它在系统中接受度越高
- 它的历史交易记录锚定越稳定

---

51%攻击是指为了控制分布式系统的集体决策，更替权威链或修改孤儿链，建立一条对发起攻击者有利交易记录的新权威链

51%攻击特点有：

- 经济上通过修改历史交易记录来改变所有权分配
- 决策上通过收集大多数投票权来改变决策结果
- 技术上建立了一个暂时的隐藏中心控制节点，进而改变系统的状态
`
---

# 20. 为诚信买单

---

区块链通过手续费来补偿节点维护系统完备性的成本

补偿的支付工具对区块链的完备性、开放度、分布式特征和系统设计哲学有影响

补偿的支付工具有如下属性：

- 数字形式提供
- 在现实世界中被接受
- 不受资本流动限制影响
- 值得信赖
- 不受任何组织控制

---

加密货币是使用区块链管理所有权的独立代币，专门作为补偿维护系统完备性的支付工具

---

# 21. 将所有碎片整合在一起

---

区块链是一种纯粹的分布式点对点系统，它用于解决所有权管理问题。

- 描述所有权: 通过交易数据的历史记录
- 保护所有权: 通过数字签名
- 存储交易数据: 区块链数据结构
- 准备分发账本: 不变性
- 分发账本: 网络传输消息
- 处理新交易: 区块链算法
- 决定哪个账本是真的: 分布式共识

---

区块链应用：

- 应用程序的目标
- 属性
- 内部运作方式

区块链的两个应用目标：

- 明确所有权
- 转移所有权

---

区块链实现了其应用目标，同时具备如下非功能特征：

- 高可用性
- 抗操作性
- 可靠性
- 开放性
- 匿名性
- 安全性
- 系统弹性
- 最终一致性
- 保持系统完备性

---

区块链实现层组成部分：

- 所有权逻辑
- 交易数据
- 交易处理逻辑
- 交易安全性

与实现层无关的组件：

- 区块链技术套件
- 分布式点对点架构

---

区块链技术套件有：

- 逻辑存储
- 共识机制
- 数据处理逻辑
- 非对称加密
